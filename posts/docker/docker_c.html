<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="../../icons/logoTit.png">
    <link rel="stylesheet" href="../../estilo.css">
    <title>UB Social</title>
</head>
<body>
<div class="container-fluid">


    <div class="row">
        <div class="col-sm-12">
            <nav class="navbar rounded-bottom fixed-top navbar-expand-lg navbar-light bg-light shadow">
                <div class="container-fluid">
                    <a class="navbar-brand" href="../../index.html"><img src="../../icons/logo.png" class="d-inline-block align-text-top" width="11pt"> UB Social</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item"><a class="nav-link" href="../../index.html">Home</a></li>
                            <li class="nav-item"><a class="nav-link" href="../../sobre/sobre.html">Sobre</a></li>
                            <li class="nav-item"><a class="nav-link" href="../../cursos.html">Cursos</a></li>
                            <li class="nav-item"><a class="nav-link" href="../../livros/livros.html">Livros</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12 text-center" id="titulo">
            <h1>Docker CÓPIA</h1>
            <h6><strong>Gerenciando Containers</strong></h6>
            <a href="../../index.html" class="btn btn-link text-decoration-none mb-3">Voltar</a>
        </div>
    </div>
        <div class="row">
            <div class="col-sm-12">
                <br><h4>Docker Compose:</h4>
                <p id="textoPost">Arquivo do tipo <i>yaml</i> chamado '<i>docker-compose.yml</i>', contendo composto (infraestrutura IAC) de configurações para automatização docker e comunicação entre containers (via nome estabelecido) e volumes, podendo haver versionamento e, com isso, melhor organização.</p>

                <p><b>Estrutura:</b></p>
                <ul>
                    <li><b>version</b>: Versão do Docker Compose utilizado (Opcional informar no docker-compose.yml);</li>
                    <li><b>services</b>: Containers que compõem o docker-compose.yml (Cada service possuirá um nome de preferência do usuário, para referenciá-lo);</li>
                    <li><b>build</b>: Alternativo ao <i>image</i>, mostra o diretório do Dockerfile para construção da Imagem;</li>
                    <li><b>image</b>: Nome da Imagem a ser construída;</li>
                    <li><b>container_name</b>: Nome do Container (De preferência do usuário);</li>
                    <li><b>ports</b>: Indica, respectivamente, portaHost:portaContainer que serão liberadas para requisições entre ambos;</li>
                    <li><b>expose</b>: Indica porta do Container que será exposta;</li>
                    <li><b>working_dir</b>: Diretório especificado, que direcionará o usuário ao entrar no Container;</li>
                    <li><b>deploy</b>: Determina regras de execução do Container, como nodes referenciados, métodos de execução, limitações de hardware, etc;</li>
                    <li><b>restart</b>: Comportamento em caso de queda do Container;
                        <ul>
                            <li><i>no</i>: Quando Container cai, o Compose não o excluirá;</li>
                            <li><i>always</i>: Quando Container cai, o Compose sempre o reiniciará;</li>
                            <li><i>on-failure</i>: Em caso de apontamento de falha, executará Container novamente;</li>
                            <li><i>unless-stopped</i>: Sempre tentará garantir o estado do Container em execução, ao menos que o mesmo seja colocado em <i>stopped</i> manualmente.</li>
                        </ul>
                    </li>
                    <li><b>restart_policy</b>: Usado dentro do <i>deploy</i>, para informar regras de reinicialização e prevenção à falhas, como quantidade de tentativas para iniciar o Container, tempo de espera para inicialização, etc;</li>
                    <li><b>networks</b>: Definir redes que serão criadas e relacionadas junto ao Container, informando, respectivamente em cada linha dependente: nomeRede, tipoRede, driverRede e subnet;</li>
                    <li><b>volumes</b>: Indicar volumes, onde o padrão é: <i>nomeVolume:diretorioInternoContainer/</i> ou personalizado: <i>diretorioInternoHostDocker:diretorioInternoContainer/</i></li>
                    <li><b>environment</b>: Variáveis de ambiente do Container, na sintaxe <i>NOME_VARIAVEL: valor</i>;</li>
                    <li><b>env_file</b>: Diretório do arquivo com lista de variáveis de ambiente onde, dentro dele, há uma variável por linha;</li>
                    <li><b>depends_on</b>: Containers que precisam existir para que o em questão funcione (Informar nome do service para referenciá-lo);</li>
                    <li><b>links</b>: Mesmo que depends_on, mas que indica também link entre outros Containers;</li>
                    <li><b>command</b> e <b>entrypoint</b>: Comandos shell personalizados que serão executados durante o up da criação do Container;</li>
                    <li><b>labels</b>: Para labels personalizadas (tituloLabel: "descricaoLabel");</li>
                    <li><b>#comentario</b>: Para comentário no arquivo docker-compose.yml (Não entrará em execução no up);</li>
                    <li class="text-muted">Existem outros componentes de Docker Compose. Para mais detalhes, visite a documentação oficial Docker na última versão.</li>
                </ul>
                
                <p><b>Exemplo 1 docker-compose.yml:</b></p>
<small><pre><code>
version: "3.7"
services:
    app:
        image: node:12-alpine
        container_name: containerNode
        command: sh -c "yarn install && yarn run dev"
        ports:
            - 3000:3000
        working_dir: /app
        volumes:
            - ./:/app
        environment:
            MYSQL_HOST: mysql
            MYSQL_USER: root
            MYSQL_PASSWORD: senhaMySQL
            MYSQL_DB: nomeBD
        restart: always
    mysql:
        image: mysql:5.7
        container_name: containerBD
        volumes:
            - volumeDockerCompose:/var/lib/mysql
        environment: 
            MYSQL_ROOT_PASSWORD: senhaMySQL
            MYSQL_DATABASE: nomeBD
        expose:
            - "5000"
        restart: always
        depends_on:
            - app
volumes:
    volumeDockerCompose: {}


<u><b>COMANDOS DOCKER-COMPOSE:</b></u>
<b>Versão docker-compose:</b> docker-compose version
<b>Executar containers do docker-compose:</b> docker-compose up (-d executa em background, build ao invés de up somente fará build das Imagens, -f seguido do diretório especificará o local e nome de arquivo do docker-compose.yml)
<b>Listar containers via docker-compose:</b> docker-compose ps
<b>Listar logs de container no docker-compose:</b> docker-compose logs -f nomeContainer
<b>Parar docker-compose/containers:</b> docker-compose stop (Ou down, para parar e remover container e componentes, start inicia e restart reinicia)
<b>Entrar em container via docker-compose:</b> docker-compose exec nomeContainer bash
<b>Aumentar réplicas de container:</b> docker-compose scale
(Pode-se, dentro, citar outros containers pelos nomes personalizados)
</code></pre></small>
                <p><b>Exemplo 2 docker-compose.yml:</b></p>
<small><pre><code>
# Criar 2 containers, um servidor com nginx e um cliente debian, que acessará o servidor nginx
version: '3'

services:
    nginx:
        image: nginx:latest
        container_name: servidor_nginx
        ports:
            - "8080:80"
        networks:
            - rede
        command: ["bash", "-c", "echo '&lt;h1&gt;Aplicação web&lt;/h1&gt;' &gt; /usr/share/nginx/html/index.html && nginx -g 'daemon off;'; sleep infinity"]
    
    debian:
        image: debian:latest
        container_name: cliente_debian
        networks:
            - rede
        command: ["bash", "-c", "apt update; apt install -y curl; sleep infinity;"]
networks:
    rede:
        driver: bridge

# 1. Executar ambiente: docker-compose up -d
# 2. Acessar container cliente: docker exec -it cliente_debian bash
# 3. Via container cliente, acessar container servidor: curl http://servidor_nginx
</code></pre></small>
            </div>
        </div>
    </div>

<!--Rodapé-->
<div class="row">
    <div class="col-sm-12 text-center bg-black text-light pt-4 pb-3">
        <p>Elaborado por Mateus Schwede<br><small class="text-muted">ubsocial.github.io</small></p>
    </div>
</div>

</div>
</body>
</html>